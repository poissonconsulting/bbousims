<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>General tools (beyond Boreal Caribou) â€¢ bbousims</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="General tools (beyond Boreal Caribou)">
<meta property="og:description" content="bbousims">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bbousims</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/bbousims.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bboutools.html">Work with bboutools</a>
    </li>
    <li>
      <a href="../articles/general.html">General tools (beyond Boreal Caribou)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/poissonconsulting/bbousims/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>General tools (beyond Boreal Caribou)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/poissonconsulting/bbousims/blob/HEAD/vignettes/general.Rmd" class="external-link"><code>vignettes/general.Rmd</code></a></small>
      <div class="hidden name"><code>general.Rmd</code></div>

    </div>

    
    
<p><code>bbousims</code> contains more flexible, general functionality
todo the following for any set of time periods and stages: generate
survival and fecundity rates; generate survival, birth and age process
matrices; project population; allocate individuals from population into
groups; sample a proportion of groups in a given period each year.</p>
<div class="section level3">
<h3 id="survival-and-fecundity-rates">Survival and fecundity rates<a class="anchor" aria-label="anchor" href="#survival-and-fecundity-rates"></a>
</h3>
<p><code><a href="../reference/bbs_survival.html">bbs_survival()</a></code> and <code><a href="../reference/bbs_fecundity.html">bbs_fecundity()</a></code> can be
used to stochastically generate survival and fecundity rates over time.
Survival varies by period (e.g., month, season) with options to set the
intercept, year trend, annual random effect, period random effect and
period within annual random effect for each stage, on the log-odds
scale.</p>
<p>The rates are provided as a vector with each element corresponding to
each stage.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># 2 stages</span></span>
<span><span class="va">survival</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_survival.html">bbs_survival</a></span><span class="op">(</span></span>
<span>  intercept <span class="op">=</span> <span class="fu"><a href="https://poissonconsulting.github.io/extras/reference/logit.html" class="external-link">logit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.94</span>, <span class="fl">0.98</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.3</span><span class="op">)</span>,</span>
<span>  annual_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.05</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  period_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  nyear <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  nperiod_within_year <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span>
<span><span class="va">survival</span><span class="op">$</span><span class="va">eSurvival</span></span>
<span><span class="co">#&gt; , , 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.9409750 0.9431849 0.9403914</span></span>
<span><span class="co">#&gt; [2,] 0.9423532 0.9445145 0.9417824</span></span>
<span><span class="co">#&gt; [3,] 0.9414638 0.9436565 0.9408848</span></span>
<span><span class="co">#&gt; [4,] 0.9364146 0.9387841 0.9357890</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; , , 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;           [,1]      [,2]      [,3]</span></span>
<span><span class="co">#&gt; [1,] 0.9840585 0.9873763 0.9900676</span></span>
<span><span class="co">#&gt; [2,] 0.9821995 0.9858986 0.9889015</span></span>
<span><span class="co">#&gt; [3,] 0.9803428 0.9844216 0.9877351</span></span>
<span><span class="co">#&gt; [4,] 0.9770252 0.9817796 0.9856468</span></span></code></pre></div>
<p>Fecundity varies by year, with options to set the intercept, year
trend and annual random effect for each stage, on the log-odds scale.
Setting intercept to NA will force all rates in that stage to be 0.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">fecundity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_fecundity.html">bbs_fecundity</a></span><span class="op">(</span></span>
<span>  intercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://poissonconsulting.github.io/extras/reference/logit.html" class="external-link">logit</a></span><span class="op">(</span><span class="fl">0.4</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  annual_sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  nyear <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span><span class="va">fecundity</span><span class="op">$</span><span class="va">eFecundity</span></span>
<span><span class="co">#&gt;      [,1]      [,2]</span></span>
<span><span class="co">#&gt; [1,]    0 0.3850636</span></span>
<span><span class="co">#&gt; [2,]    0 0.3573003</span></span>
<span><span class="co">#&gt; [3,]    0 0.2913105</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="process-matrices">Process matrices<a class="anchor" aria-label="anchor" href="#process-matrices"></a>
</h3>
<p>Survival and fecundity rate arrays can be converted into process
matrices for use in matrix model population projection. In this example
there are two stages representing recruit and adult.<br><code>male_recruit_stage</code> is set to NULL to indicate that there is
only one recruit stage.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survival_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_matrix_survival_period.html">bbs_matrix_survival_period</a></span><span class="op">(</span><span class="va">survival</span><span class="op">$</span><span class="va">eSurvival</span><span class="op">)</span></span>
<span><span class="va">birth_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_matrix_birth_year.html">bbs_matrix_birth_year</a></span><span class="op">(</span><span class="va">fecundity</span><span class="op">$</span><span class="va">eFecundity</span>,</span>
<span>  female_recruit_stage <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  male_recruit_stage <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># first period, first year</span></span>
<span><span class="va">survival_mat</span><span class="op">[</span>, , <span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#&gt;          [,1]      [,2]</span></span>
<span><span class="co">#&gt; [1,] 0.940975 0.0000000</span></span>
<span><span class="co">#&gt; [2,] 0.000000 0.9840585</span></span>
<span></span>
<span><span class="co"># first year</span></span>
<span><span class="va">birth_mat</span><span class="op">[</span>, , <span class="fl">1</span><span class="op">]</span></span>
<span><span class="co">#&gt;      [,1]      [,2]</span></span>
<span><span class="co">#&gt; [1,]    1 0.1925318</span></span>
<span><span class="co">#&gt; [2,]    0 1.0000000</span></span></code></pre></div>
<p><code><a href="../reference/bbs_matrix_age.html">bbs_matrix_age()</a></code> is used to generate an age process
matrix, which does not vary in time. The input vector denotes which
stage that stage will age into (i.e., stage 1 ages to stage 2, stage 2
collects).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_mat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_matrix_age.html">bbs_matrix_age</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">age_mat</span></span>
<span><span class="co">#&gt;      [,1] [,2]</span></span>
<span><span class="co">#&gt; [1,]    0    0</span></span>
<span><span class="co">#&gt; [2,]    1    1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="population-projection">Population projection<a class="anchor" aria-label="anchor" href="#population-projection"></a>
</h3>
<p><code>bbousims</code> contains a custom infix operator
<code>%*b%</code> to perform matrix multiplication with stochasticity.
Instead of multiplying the population at each stage by the corresponding
rate, <code>%*b%</code> draws from a binomial distribution, where size
is the population and probability is the rate of interest.</p>
<p>For example, with an initial population vector and survival process
matrix for the first period of the first year</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25</span>, <span class="fl">52</span><span class="op">)</span></span>
<span><span class="va">survival_mat1</span> <span class="op">&lt;-</span> <span class="va">survival_mat</span><span class="op">[</span>, , <span class="fl">1</span>, <span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<p>regular (deterministic) matrix multiplication yields</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">survival_mat1</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">pop0</span></span>
<span><span class="co">#&gt;          [,1]</span></span>
<span><span class="co">#&gt; [1,] 23.52438</span></span>
<span><span class="co">#&gt; [2,] 51.17104</span></span></code></pre></div>
<p>and stochastic matrix multiplication yields</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">survival_mat1</span> <span class="op"><a href="../reference/grapes-times-b-grapes.html">%*b%</a></span> <span class="va">pop0</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]   24</span></span>
<span><span class="co">#&gt; [2,]   52</span></span></code></pre></div>
<p><code><a href="../reference/bbs_population.html">bbs_population()</a></code> is used to project population forward
in time from survival, age and birth process matrices. Survival occur at
the end of each period, and survival, ageing and birth occur at the end
of each year, in that order.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_population.html">bbs_population</a></span><span class="op">(</span><span class="va">pop0</span>,</span>
<span>  birth <span class="op">=</span> <span class="va">birth_mat</span>,</span>
<span>  age <span class="op">=</span> <span class="va">age_mat</span>,</span>
<span>  survival <span class="op">=</span> <span class="va">survival_mat</span></span>
<span><span class="op">)</span></span>
<span><span class="va">population</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]</span></span>
<span><span class="co">#&gt; [1,]   25   23   23   20   10   10   10   10   15    13    12    12    15</span></span>
<span><span class="co">#&gt; [2,]   52   50   48   47   66   65   63   62   68    68    68    68    79</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="group-allocation">Group allocation<a class="anchor" aria-label="anchor" href="#group-allocation"></a>
</h3>
<p><code><a href="../reference/bbs_population_groups.html">bbs_population_groups()</a></code> is used to randomly allocate
individuals at each time step into groups. Group sizes are randomly
drawn from a gamma-poisson distribution with user-specified
<code>lambda</code> and <code>theta</code> (dispersion parameter)
values. Minimum and maximum (i.e., as a maximum proportion of the total
population) group sizes can be set. Group sizes are drawn until the
cumulative size exceeds the total individuals. The remaining individuals
comprise the final group. If the remaining number of individuals is &lt;
minimum group size specified by the user, these will be added to the
previous group.</p>
<p>The output is a list of lists containing the individuals (identified
by stage) in each group at each time period.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_population_groups.html">bbs_population_groups</a></span><span class="op">(</span><span class="va">population</span>,</span>
<span>  group_size_lambda <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  group_size_theta <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># first time period</span></span>
<span><span class="va">groups</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;  [1] 2 2 2 2 2 2 2 1 2 2 2 2 2 1 2 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;  [1] 1 2 2 2 2 2 1 2 1 1 2 1 1 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;  [1] 2 1 2 2 1 2 2 2 1 1 2 1 2 2 2 2 2 1 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt;  [1] 2 2 1 1 2 2 1 2 2 1 2 2 2 2 1 2 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt;  [1] 1 2 2 2 1 1 2 1 1 2 1</span></span></code></pre></div>
<p><code><a href="../reference/bbs_population_groups_pairs.html">bbs_population_groups_pairs()</a></code> behaves similarly but
keeps calf-cow pairs (or equivalent for different animals) together in
groups whenever possible.</p>
<p><code><a href="../reference/bbs_population_groups_survey.html">bbs_population_groups_survey()</a></code> allocates individuals
into groups once a year (month of composition survey relative to
biological year start) and allows the user to set the sample coverage
(i.e., the proportion of groups observed). Groups are sampled
randomly.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_population_groups_survey.html">bbs_population_groups_survey</a></span><span class="op">(</span><span class="va">population</span>,</span>
<span>  group_size_lambda <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  month_composition <span class="op">=</span> <span class="fl">3L</span>,</span>
<span>  group_coverage <span class="op">=</span> <span class="fl">0.2</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># sampled groups in first time period</span></span>
<span><span class="va">groups</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt;  [1] 2 1 2 1 2 2 2 2 2 1 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 1 2 1 2 1</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Seb Dalgarno, Joe Thorley, John Boulanger, Ayla Pearson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
