<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get Started with bbousims • bbousims</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get Started with bbousims">
<meta property="og:description" content="bbousims">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">bbousims</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/bbousims.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/bboutools.html">Work with bboutools</a>
    </li>
    <li>
      <a href="../articles/general.html">General tools (beyond Boreal Caribou)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/poissonconsulting/bbousims/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get Started with bbousims</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/poissonconsulting/bbousims/blob/HEAD/vignettes/bbousims.Rmd" class="external-link"><code>vignettes/bbousims.Rmd</code></a></small>
      <div class="hidden name"><code>bbousims.Rmd</code></div>

    </div>

    
    
<!-- # Copyright 2024 Province of Alberta -->
<!-- # -->
<!-- # Licensed under the Apache License, Version 2.0 (the "License"); -->
<!-- # you may not use this file except in compliance with the License. -->
<!-- # You may obtain a copy of the License at -->
<!-- # -->
<!-- # http://www.apache.org/licenses/LICENSE-2.0 -->
<!-- # -->
<!-- # Unless required by applicable law or agreed to in writing, software -->
<!-- # distributed under the License is distributed on an "AS IS" BASIS, -->
<!-- # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. -->
<!-- # See the License for the specific language governing permissions and -->
<!-- # limitations under the License. -->
<p>There are four key steps to simulating Boreal Caribou survival and
recruitment data:</p>
<ol style="list-style-type: decimal">
<li>Generate survival and fecundity rates by stage and period.<br>
</li>
<li>Project population using a stochastic matrix model accounting for
survival, ageing and birth, in that order.<br>
</li>
<li>Generate recruitment data by randomly assigning projected population
into groups and randomly observing some proportion of those groups
during the composition survey month.<br>
</li>
<li>Generate survival data by simulating monthly collared adult female
mortalities from survival rates.</li>
</ol>
<p>Any number of survival and recruitment data sets can be simulated
from a single set of survival and fecundity rates.</p>
<div class="section level3">
<h3 id="simulate-survival-and-fecundity-rates">Simulate survival and fecundity rates<a class="anchor" aria-label="anchor" href="#simulate-survival-and-fecundity-rates"></a>
</h3>
<p>Survival rates are simulated for each month, year and stage with
<code><a href="../reference/bbs_survival_caribou.html">bbs_survival_caribou()</a></code> and fecundity rates are simulated
for each year and stage with <code><a href="../reference/bbs_fecundity_caribou.html">bbs_fecundity_caribou()</a></code>.</p>
<p>Rates are generated for three stages: female calf, female yearling,
and female adult.</p>
<p>Survival rates for female calves and female adults are generated
stochastically from linear models taking the following form (simplified
for readability):</p>
<p><span class="math display">\[
\text{logit}(Survival_{y,m}) = \beta_0 + \beta_Y \cdot Year_{y} +
\beta_{A_{y}} + \beta_{M_{m}} + \beta_{AM_{y,m}}
\]</span></p>
<p>The intercept (<span class="math inline">\(\beta_0\)</span>) is
provided by the user to <code><a href="../reference/bbs_survival_caribou.html">bbs_survival_caribou()</a></code> as the
annual survival rate in the first year. Internally, this rate is
transformed to a monthly rate on the log-odds scale.</p>
<p><span class="math inline">\(\beta_{A}\)</span>, <span class="math inline">\(\beta_{M}\)</span> and <span class="math inline">\(\beta_{AM}\)</span> are random effects
representing the annual variation, monthly variation and month within
annual variation on the log-odds scale. Random effects are generated
stochastically from a normal distribution with a mean of 0 and standard
deviation provided by the user.</p>
<p><span class="math inline">\(\beta_{Y}\)</span> is a trend
representing the effect of an increase of one year on the log-odds
monthly survival rate.</p>
<p>Female calf and female adult survival rates are specified from
separate linear models, whereas female yearling survival is specified as
an effect on female adult survival.</p>
<p>Fecundity rates are generated from a linear model taking the
(simplified) form: <span class="math display">\[
\text{logit}(Fecundity_{y,m}) = \beta_0 + \beta_Y \cdot Year_{y} +
\beta_{A_{y}}
\]</span> The intercept (<span class="math inline">\(\beta_0\)</span>)
is provided to <code><a href="../reference/bbs_fecundity_caribou.html">bbs_fecundity_caribou()</a></code> as the annual rate
of calves per adult female in the first year.<br>
Internally, this is transformed to the log-odds scale.</p>
<p>As in <code><a href="../reference/bbs_survival_caribou.html">bbs_survival_caribou()</a></code>, the standard deviation of
the annual variation on the log-odds scale (<span class="math inline">\(\beta_A\)</span>) is provided by the user and the
trend (<span class="math inline">\(\beta_Y\)</span>) represents the
effect of an increase of one year on the log-odds calves per adult
female.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">nyear</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">survival</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_survival_caribou.html">bbs_survival_caribou</a></span><span class="op">(</span></span>
<span>  survival_adult_female <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>  annual_sd_adult_female <span class="op">=</span> <span class="fl">0.2</span>,</span>
<span>  month_sd_adult_female <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  survival_calf_female <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  yearling_effect <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  nyear <span class="op">=</span> <span class="va">nyear</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fecundity</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_fecundity_caribou.html">bbs_fecundity_caribou</a></span><span class="op">(</span></span>
<span>  calves_per_adult_female <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  annual_sd <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  trend <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  nyear <span class="op">=</span> <span class="va">nyear</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The output of <code><a href="../reference/bbs_survival_caribou.html">bbs_survival_caribou()</a></code> is a list
containing the intercept (<code>b0</code>), trend (<code>bYear</code>),
individual random effects (<code>bAnnual</code>, <code>bMonth</code>,
and <code>bAnnualMonth</code>) and the expected monthly survival,
<code>eSurvival</code>.</p>
<p><code>eSurvival</code> is an array with the survival rate in each
month, year and stage.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># adult female (stage 3) survival rates for the first 5 years</span></span>
<span><span class="va">survival</span><span class="op">$</span><span class="va">eSurvival</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">3</span><span class="op">]</span></span>
<span><span class="co">#&gt;            [,1]      [,2]      [,3]      [,4]      [,5]</span></span>
<span><span class="co">#&gt;  [1,] 0.9834999 0.9859332 0.9828071 0.9893564 0.9863321</span></span>
<span><span class="co">#&gt;  [2,] 0.9854934 0.9876364 0.9848830 0.9906491 0.9879876</span></span>
<span><span class="co">#&gt;  [3,] 0.9858478 0.9879391 0.9852521 0.9908787 0.9882818</span></span>
<span><span class="co">#&gt;  [4,] 0.9856192 0.9877438 0.9850140 0.9907306 0.9880920</span></span>
<span><span class="co">#&gt;  [5,] 0.9843153 0.9866300 0.9836561 0.9898854 0.9870094</span></span>
<span><span class="co">#&gt;  [6,] 0.9868873 0.9888267 0.9863348 0.9915518 0.9891445</span></span>
<span><span class="co">#&gt;  [7,] 0.9853533 0.9875167 0.9847371 0.9905583 0.9878713</span></span>
<span><span class="co">#&gt;  [8,] 0.9838201 0.9862068 0.9831405 0.9895642 0.9865981</span></span>
<span><span class="co">#&gt;  [9,] 0.9810780 0.9838626 0.9802856 0.9877835 0.9843193</span></span>
<span><span class="co">#&gt; [10,] 0.9863772 0.9883911 0.9858034 0.9912215 0.9887211</span></span>
<span><span class="co">#&gt; [11,] 0.9847123 0.9869692 0.9840696 0.9901428 0.9873391</span></span>
<span><span class="co">#&gt; [12,] 0.9847556 0.9870061 0.9841146 0.9901709 0.9873750</span></span></code></pre></div>
<p>The output of <code><a href="../reference/bbs_fecundity_caribou.html">bbs_fecundity_caribou()</a></code> is a list
containing the intercept (<code>b0</code>), trend (<code>bYear</code>),
individual annual random effects (<code>bAnnual</code>) and the expected
annual calves per adult female, <code>eFecundity</code>.</p>
<p><code>eFecundity</code> is an matrix with the fecundity rates for
each year and stage.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fecundity</span><span class="op">$</span><span class="va">eFecundity</span></span>
<span><span class="co">#&gt;      [,1] [,2]      [,3]</span></span>
<span><span class="co">#&gt; [1,]    0    0 0.7194392</span></span>
<span><span class="co">#&gt; [2,]    0    0 0.7269931</span></span>
<span><span class="co">#&gt; [3,]    0    0 0.7323715</span></span>
<span><span class="co">#&gt; [4,]    0    0 0.7482302</span></span>
<span><span class="co">#&gt; [5,]    0    0 0.7550096</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="project-population">Project population<a class="anchor" aria-label="anchor" href="#project-population"></a>
</h2>
<p>Boreal Caribou population is projected from survival, ageing and
birth using a matrix model. Survival occurs at the end of each month and
survival, ageing and birth occur at the end of each year, in that
order.</p>
<p>Internally, a custom function (<code>%*b%</code>) is used for
stochastic matrix multiplication in each period. For demonstration, the
survival rates for the first period are converted to a process matrix
and multiplied by an initial population vector.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">initial_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">80</span>, <span class="fl">180</span><span class="op">)</span></span>
<span><span class="va">survival_mat1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_matrix_survival.html">bbs_matrix_survival</a></span><span class="op">(</span><span class="va">survival</span><span class="op">$</span><span class="va">eSurvival</span><span class="op">[</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span>
<span><span class="va">survival_mat1</span> <span class="op"><a href="../reference/grapes-times-b-grapes.html">%*b%</a></span> <span class="va">initial_pop</span></span>
<span><span class="co">#&gt;      [,1]</span></span>
<span><span class="co">#&gt; [1,]   96</span></span>
<span><span class="co">#&gt; [2,]   79</span></span>
<span><span class="co">#&gt; [3,]  177</span></span></code></pre></div>
<p>Initial population abundance for each stage is determined from the
initial number of adult females set by the user and the calculated
stable stage distribution, which is informed by the calves per adult
female intercept, adult female survival intercept, calf survival
intercept and sex ratio (see <code><a href="../reference/bbs_demographic_summary.html">bbs_demographic_summary()</a></code> for
details).<br>
Population abundance for male stages are drawn stochastically from a
binomial distribution, with probability from user-provided sex
ratios.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_population_caribou.html">bbs_population_caribou</a></span><span class="op">(</span><span class="va">survival</span>,</span>
<span>  fecundity <span class="op">=</span> <span class="va">fecundity</span>,</span>
<span>  adult_females <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  proportion_adult_female <span class="op">=</span> <span class="fl">0.65</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The output is a matrix with abundance for each period and stage. The
first period is the initial population and period 13 is the final month
of the first year. Stages are female calf, male calf, female yearling,
male yearling, female adult and male adult, in that order.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># projected population for first year</span></span>
<span><span class="va">population</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">13</span><span class="op">]</span></span>
<span><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10] [,11] [,12] [,13]</span></span>
<span><span class="co">#&gt; [1,]  177  163  149  145  136  129  123  118  113   108   102    98   173</span></span>
<span><span class="co">#&gt; [2,]  152  178  158  148  134  133  128  118  104   107   116   103   172</span></span>
<span><span class="co">#&gt; [3,]   97   97   95   95   94   92   90   88   87    84    83    81    91</span></span>
<span><span class="co">#&gt; [4,]   97   96   87   92   90   83  100   85   86    92    88    84    97</span></span>
<span><span class="co">#&gt; [5,]  500  488  480  476  467  453  443  439  437   430   424   417   490</span></span>
<span><span class="co">#&gt; [6,]  273  247  253  249  259  237  247  250  243   213   229   246   276</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bbs_plot_population.html">bbs_plot_population</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span></span></code></pre></div>
<p><img src="bbousims_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>It can be useful to view estimates of key demographic summary metrics
(i.e., lambda, recruitment, stable stage distribution) prior to
simulating data, e.g., to assess the stability of the population.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/bbs_demographic_summary.html">bbs_demographic_summary</a></span><span class="op">(</span></span>
<span>  calves_per_adult_female <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  survival_adult_female <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>  survival_calf <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>  proportion_female <span class="op">=</span> <span class="fl">0.65</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $calf_cow_ratio</span></span>
<span><span class="co">#&gt; [1] 0.2745098</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $recruitment</span></span>
<span><span class="co">#&gt; [1] 0.1514143</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $lambda</span></span>
<span><span class="co">#&gt; [1] 1.010857</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $stable_stage_dist</span></span>
<span><span class="co">#&gt; [1] 0.2434066 0.1203962 0.6361972</span></span></code></pre></div>
<p>As another example of population projection, adding a high negative
trend, high standard deviation of the annual variation in the adult
female survival and adult female proportion of 0.5 will cause higher
variation, downward projection of population and similar number of males
and females.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">nyear</span> <span class="op">&lt;-</span> <span class="fl">20</span></span>
<span><span class="va">survival2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_survival_caribou.html">bbs_survival_caribou</a></span><span class="op">(</span></span>
<span>  survival_adult_female <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>  annual_sd_adult_female <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  trend_adult_female <span class="op">=</span> <span class="op">-</span><span class="fl">0.1</span>,</span>
<span>  nyear <span class="op">=</span> <span class="va">nyear</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fecundity2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_fecundity_caribou.html">bbs_fecundity_caribou</a></span><span class="op">(</span></span>
<span>  calves_per_adult_female <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>  nyear <span class="op">=</span> <span class="va">nyear</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">population2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_population_caribou.html">bbs_population_caribou</a></span><span class="op">(</span><span class="va">survival2</span>,</span>
<span>  fecundity <span class="op">=</span> <span class="va">fecundity2</span>,</span>
<span>  adult_females <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  proportion_adult_female <span class="op">=</span> <span class="fl">0.5</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/bbs_plot_population.html">bbs_plot_population</a></span><span class="op">(</span><span class="va">population2</span><span class="op">)</span></span></code></pre></div>
<p><img src="bbousims_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<div class="section level3">
<h3 id="allocate-and-sample-groups">Allocate and sample groups<a class="anchor" aria-label="anchor" href="#allocate-and-sample-groups"></a>
</h3>
<p>Individuals in a projected population can be allocated into groups in
each period. The user can adjust the group size (drawn from a
gamma-poisson distribution with mean lambda and dispersion parameter
theta), minimum group size and maximum group size as proportion of total
population. Individuals are assigned randomly to groups until they are
filled. See <code><a href="../reference/bbs_population_groups.html">?bbs_population_groups</a></code> for more details on the
algorithm.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">groups</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_population_groups.html">bbs_population_groups</a></span><span class="op">(</span><span class="va">population</span>, </span>
<span>                                group_size_lambda <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                                group_size_theta <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                                group_min_size <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                                group_max_proportion <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p>The output is a list of lists representing the period and groups
within each period. Each group is a vector representing individuals and
their stage.</p>
<p>For example, the first group in the first period has 7 individuals
comprised of 3 female adults, 1 female calf, 2 male calves, and 1 male
yearling.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">groups</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 5 5 1 5 4 2 2</span></span></code></pre></div>
<p>Groups can be sampled in each composition survey month using
<code><a href="../reference/bbs_population_groups_survey.html">bbs_population_groups_survey()</a></code>. The proportion of groups
observed is set with <code>group_coverage</code>.
<code>month_composition</code> is relative to the start of the
biological year.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">groups_observed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_population_groups_survey.html">bbs_population_groups_survey</a></span><span class="op">(</span><span class="va">population</span>, </span>
<span>                                                month_composition <span class="op">=</span> <span class="fl">9L</span>,</span>
<span>                                                group_size_lambda <span class="op">=</span> <span class="fl">6</span>, </span>
<span>                                                group_min_size <span class="op">=</span> <span class="fl">2</span>, </span>
<span>                                                group_coverage <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p>The output is a list of lists representing the year and groups within
each year.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># observed groups in first year </span></span>
<span><span class="va">groups_observed</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 5 5 1 5 5 5 5 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt;  [1] 5 2 3 5 6 3 5 5 2 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt;  [1] 5 2 2 4 2 5 5 6 6 1 5 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 5 2 6 6 1 2 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt;  [1] 1 5 6 1 4 3 5 4 1 2 4 2 5 6 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[6]]</span></span>
<span><span class="co">#&gt;  [1] 5 5 6 3 6 5 3 6 5 3 5 5 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[7]]</span></span>
<span><span class="co">#&gt;  [1] 5 5 5 5 5 1 6 5 6 5 5 5 2 5 5 5 6 3 5 5 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[8]]</span></span>
<span><span class="co">#&gt;  [1] 2 5 2 2 2 5 5 4 5 2 5 3 5 6 5 2 5 5 3 5 3 1 3</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[9]]</span></span>
<span><span class="co">#&gt; [1] 5 5 1 5 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[10]]</span></span>
<span><span class="co">#&gt; [1] 3 1 2 6 5 3 4 2 1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="simulate-abundance-survival-and-recruitment-data">Simulate abundance, survival and recruitment data<a class="anchor" aria-label="anchor" href="#simulate-abundance-survival-and-recruitment-data"></a>
</h3>
<p>Abundance, survival and recruitment data are simulated from
hypothetical composition surveys and collaring with
<code><a href="../reference/bbs_simulate_caribou.html">bbs_simulate_caribou()</a></code>. The main inputs are the periodic
survival and fecundity rates and a set of key sampling parameters.
Internally, <code>bbs_project_population()</code> is used to project
population and <code><a href="../reference/bbs_population_groups_survey.html">bbs_population_groups_survey()</a></code> is used to
allocate and sample groups.</p>
<p>Any number of simulated abundance, survival and recruitment data sets
can be generated from a single set of survival and fecundity rates. The
output is a list of lists of the abundance, survival, and recruitment
data.frames for each simulation.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># 10 simulations</span></span>
<span><span class="va">nsims</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bbs_simulate_caribou.html">bbs_simulate_caribou</a></span><span class="op">(</span></span>
<span>  survival <span class="op">=</span> <span class="va">survival</span>,</span>
<span>  fecundity <span class="op">=</span> <span class="va">fecundity</span>,</span>
<span>  nsims <span class="op">=</span> <span class="va">nsims</span>,</span>
<span>  adult_females <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  proportion_adult_female <span class="op">=</span> <span class="fl">0.65</span>,</span>
<span>  month_composition <span class="op">=</span> <span class="fl">9L</span>,</span>
<span>  collared_adult_females <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  group_size <span class="op">=</span> <span class="fl">6</span>,</span>
<span>  group_coverage <span class="op">=</span> <span class="fl">0.3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Key sampling parameters for recruitment data include month of
composition survey, mean group size, minimum group size, maximum group
size (as proportion of total population), proportion of groups observed
(<code>group_coverage</code>), probability that an adult female has
unknown sex, and probability that an adult male has unknown sex.</p>
<p>Each row in the recruitment dataset is an observed group with total
number of cows, bulls, yearlings, calves and unknown adults.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">recruitment</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 252 × 9</span></span></span>
<span><span class="co">#&gt;     Year Month PopulationName   Day  Cows Bulls Yearlings Calves UnknownAdults</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1     9 A                  1     4     2         1      2             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1     9 A                  1     1     0         1      2             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     1     9 A                  1     3     1         4      0             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     1     9 A                  1     1     1         0      2             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     1     9 A                  1     1     4         0      2             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     1     9 A                  1     0     1         2      0             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     1     9 A                  1     2     1         0      2             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     1     9 A                  1     3     1         0      2             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     1     9 A                  1     3     4         1      4             0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     1     9 A                  1     3     0         2      1             0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 242 more rows</span></span></span></code></pre></div>
<p>Key sampling parameters for survival data are the collaring month,
number of collars, probability of uncertain mortality (i.e., collar lost
and assumed dead), probability of uncertain survival (i.e., collar lost
and assumed alive). The number of collars are ‘topped up’ each year in
the collaring month.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">survival</span>, n <span class="op">=</span> <span class="fl">13</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 60 × 6</span></span></span>
<span><span class="co">#&gt;     Year Month PopulationName StartTotal MortalitiesCertain MortalitiesUncertain</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1     1 A                      50                  0                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1     2 A                      50                  0                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     1     3 A                      50                  1                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     1     4 A                      49                  1                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     1     5 A                      48                  0                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     1     6 A                      48                  2                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     1     7 A                      46                  1                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     1     8 A                      45                  0                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     1     9 A                      45                  1                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     1    10 A                      44                  0                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>     1    11 A                      44                  0                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>     1    12 A                      44                  1                    0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>     2     1 A                      50                  1                    0</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 47 more rows</span></span></span></code></pre></div>
<p>The recruitment and survival data are formatted to be used as input
for <code>bboutools</code> model fitting functions.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/poissonconsulting/bboutools" class="external-link">bboutools</a></span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu">bboutools</span><span class="fu">::</span><span class="fu"><a href="https://poissonconsulting.github.io/bboutools/reference/bb_fit_survival.html" class="external-link">bb_fit_survival</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">survival</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Seb Dalgarno, Joe Thorley, John Boulanger, Ayla Pearson.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
