---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
library(bbousims)
```

# bbousims

<!-- badges: start -->
[![R-CMD-check](https://github.com/poissonconsulting/bbousims/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/poissonconsulting/bbousims/actions/workflows/R-CMD-check.yaml)
[![Codecov test coverage](https://codecov.io/gh/poissonconsulting/bbousims/branch/main/graph/badge.svg)](https://app.codecov.io/gh/poissonconsulting/bbousims?branch=main)
<!-- badges: end -->

`bbousims` is a package to simulate Boreal Caribou population abundance over time from survival, ageing and birth processes.  
Survival and recruitment data from hypothetical composition surveys and collaring are simulated from key sampling parameters.

The output of `bbs_simulate_caribou()` is intended to be used as input data for [bboutools](https://poissonconsulting.github.io/bboutools/) functions for fitting survival and recruitment models and predicting population growth. 

In addition, there is more general functionality for simulating population abundance given any set of stages, period duration, and survival, ageing and birth process matrices.

## Installation

You can install the development version of bbousims from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("poissonconsulting/bbousims")
```

## Introduction

### Simulate survival and fecundity rates
Simulate survival rates for each month, year and stage and fecundity rates for each year and stage.
Rates are generated for female stages (female calf, female yearling and female adult).

```{r}
set.seed(1)
survival <- bbs_survival_caribou(survival_adult_female = 0.84, 
                                 annual_sd_adult_female = 0.2,
                                 nyear = 5)

fecundity <- bbs_fecundity_caribou(calves_per_adult_female = 0.7, 
                                   annual_sd = 0.1,
                                   nyear = 5)

# view expected monthly survival rates for adult females (stage 3) by each month and year
survival$eSurvival[,,3]
```

### Project population
Population is projected from survival and fecundity rates. 
Survival occurs at the end of each month and survival, ageing and birth occur at the end of each year, in that order.  

Initial population abundance for each stage is determined from the initial number of adult females (set by the user) and the calculated stable stage distribution (see output of `bbs_demographic_summary()` for details).
Population abundance for male stages are based on user-provided sex ratios. 


```{r}
set.seed(1)
population <- bbs_population_caribou(survival,
                                     fecundity = fecundity,
                                     adult_females = 500, 
                                     proportion_adult_female = 0.65)

bbs_plot_population(population)
```

### Simulate abundance, survival and recruitment data
Abundance, survival and recruitment data are simulated from hypothetical composition surveys and collaring. 
The output is a list of lists of survival/abundance/recruitment data.frames for each simulation.

```{r}
set.seed(1)
data <- bbs_simulate_caribou(survival = survival,
                             fecundity = fecundity,
                             nsims = 10,
                             adult_females = 500,
                             proportion_adult_female = 0.65,
                             month_composition = 9L,
                             collared_adult_females = 30,
                             group_size = 6, 
                             group_coverage = 0.3)

bbs_plot_population(data)
```

The survival and recruitment data.frames in the output of `bbs_simulate_caribou()` are intended to be used as input data for model fitting functions in the [bboutools package]("https://poissonconsulting.github.io/bboutools/).

```{r, eval=FALSE}
# fit model for each simulation
fits <- lapply(1:length(data), function(x){
  survival <- data[[x]]$survival
  bboutools::bb_fit_survival(data = survival, nthin = 1, niters = 1)
})

```



